// Generated by CoffeeScript 1.9.1
(function() {
  var overviewController;

  overviewController = angular.module('adminHelper.ACS.controllers');

  overviewController.controller('ACSRequestAddModalController', [
    '$scope', '$modalInstance', 'djangoForm', 'Restangular', 'sessionFactory', function($scope, $modalInstance, djangoForm, Restangular, sessionFactory) {
      var requestBase, ruleBase;
      ruleBase = Restangular.all('api/ACSRules');
      requestBase = Restangular.all('api/ACSRequests');
      $scope.ok = function() {
        var ruleRequest;
        ruleRequest = ruleBase.post({
          person: $scope.ACSRule.person,
          zone: $scope.ACSRule.zone
        });
        return ruleRequest.then(function(rule) {
          var requestRequest;
          requestRequest = requestBase.post({
            rule: rule.id,
            user: sessionFactory.user.id,
            grant_privilege: $scope.ACSRequest.grant_privilege
          });
          return requestRequest.then(function() {
            return $modalInstance.close();
          }, function(response) {
            if (response.status === 400) {
              return djangoForm.setErrors($scope.ACSRequestForm, response.data);
            }
          });
        }, function(response) {
          if (response.status === 400) {
            return djangoForm.setErrors($scope.ACSRuleForm, response.data);
          }
        });
      };
      return $scope.cancel = function() {
        return $modalInstance.dismiss('cancel');
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=addACSRequest.controller.js.map
